<% include ../upload/uploads-layouts/head %>

    <section id="main-content">
        <section class="wrapper">
            <h3><i class="fa fa-angle-right"></i> Zona Administrativa</h3>


            <div class="modal fade" id="vizualizar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">Criar Nova Pasta</h4>
                        </div>
                        <div class="modal-body">

                            <div class="col-md-12 mb" style="background: #3D3D3D;color:white;">
                                <center>
                                    <h4>Alterar os dados ..</h4></center>
                            </div>
                            <center>
                                <span id="erro2"></span></center>

                            <form class="form-horizontal style-form">

                                <div class="form-group">
                                    <label class="col-lg-2 col-sm-2 control-label">Id :</label>
                                    <div class="col-lg-10">
                                        <p class="form-control-static">
                                            <span id="id_modal"></p></span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-2 col-sm-2 control-label">Data e hora da criação da conta :</label>
                                    <div class="col-lg-10">
                                        <p class="form-control-static">
                                            <span id="data_modal"></p></span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-2 col-sm-2 control-label">Usuario :</label>
                                    <div class="col-lg-10">
                                        <p class="form-control-static">
                                            <span id="us"></p></span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-2 col-sm-2 control-label">Nome :</label>
                                    <div class="col-lg-10">
                                        <p class="form-control-static">
                                            <span id="nome">   </span>
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-2 col-sm-2 control-label">Email :</label>
                                    <div class="col-lg-10">
                                        <p class="form-control-static">
                                            <span id="email">  </span>
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-2 col-sm-2 control-label">Password :</label>
                                    <div class="col-lg-10">
                                        <p class="form-control-static">
                                            <span id="password_addd"></span><code> Por motivos de segurança n sera mostrada a password !!</code> </p>
                                        </span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-2 col-sm-2 control-label">Tipo de conta :</label>
                                    <div class="col-lg-10">
                                        <p class="form-control-static">
                                            <span id="tipo_modal"></p></span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-2 col-sm-2 control-label">Estado da conta :</label>
                                    <div class="col-lg-10">
                                        <p class="form-control-static">
                                            <span id="estado_modal"></p></span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-2 col-sm-2 control-label">Espaço atribuido á conta:</label>
                                    <div class="col-lg-10">
                                        <p class="form-control-static">
                                            <span id="tamanho_modal"></p></span>
                                    </div>
                                </div>
                                <span id="remover_conta"></span>
                                <span id="alterar_modal"> <button type="button" class="btn btn-warning" onclick="vizualizar_modal()">Alterar</button> </span>
                                <span id="alterar_passwor"> <button type="button" class="btn btn-warning" onclick="vizualizar_pass()">Alterar Password</button> </span>
                                <span id="cancelar_modal"></span>
                                <span id="salvar_modal"></span>

                            </form>
                        </div>
                        <div class="modal-footer">

                            <button type="button" class="btn btn-danger" data-dismiss="modal">Fechar</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb">
                <div class="white-panel pn">
                    <div class="white-header">
                        <h5>USUARIO</h5>
                    </div>
                    <p><img src="../imagens/icon.png" class="img-circle" width="80"></p>
                    <p><b><%=user.local.nome %></b></p>
                    <div class="row">
                        <div class="col-md-6">
                            <p class="small mt">EMAIL</p>
                            <p>
                                <span id="painel_email"><%=user.local.email%></span>
                            </p>
                        </div>
                        <div class="col-md-6">
                            <p class="small mt">REGISTADO DESDE</p>
                            <p>2016</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="white-panel pn donut-chart">
                    <div class="white-header">
                        <h5>Desempenho Do Servidor</h5>
                    </div>
                    <div class="row">
                        <div class="col-sm-6 col-xs-6 goleft">
                            <p><i class="fa fa-database"></i>
                                <%=cpu %>%</p>
                        </div>
                    </div>
                    <canvas id="serverstatus01" height="120" width="120"></canvas>

                </div>
            </div>


            <div class="col-md-3 mb">
                <div class="white-panel pn">
                    <div class="white-header">
                        <h5>Utilização do espaço</h5>
                    </div>
                    <canvas id="serverstatus02" height="120" width="120"></canvas>

                    <p>
                        <%=data%>
                    </p>
                    <footer>
                        <div class="pull-left">
                            <h5>&nbsp&nbsp<i class="fa fa-hdd-o"></i> <%=user.local.size%> Mb</h5>
                        </div>
                        <div class="pull-right">
                            <h5><%=perc%> % (<%= espaço %>) Used &nbsp</h5>
                        </div>
                    </footer>
                </div>
            </div>

            <div class="col-md-3 mb">
                <div class="white-panel pn">
                    <div class="white-header">
                        <h5>Utilização do espaço (Total do servidor)</h5>
                    </div>
                    <canvas id="serverstatus04" height="120" width="120"></canvas>
                    <script>
                    </script>
                    <p>
                        <%=data%>
                    </p>
                    <footer>
                        <div class="pull-left">
                            <h5>&nbsp&nbsp<i class="fa fa-hdd-o"></i> 1000 Mb</h5>
                        </div>
                        <div class="pull-right">
                            <h5><%=total_2%> % (<%= total_1 %>) Used &nbsp</h5>
                        </div>
                    </footer>
                </div>
            </div>


            <div class="row mt">
                <div class="col-md-12 mb">
                    <div class="form-panel">
                        <div class="col-md-3 mb" style="background: #3D3D3D;color:white;">
                            <center>
                                <h4>Usuarios ..</h4></center>
                        </div>
                        <form class="form-horizontal style-form" action="../user" method="post">
                            <table id="minhaTabela" class="table table-striped table-advance table-responsive table-hover">
                                <hr>
                                <thead>
                                    <tr>
                                        <th>Id:</th>
                                        <th>Nome:</th>
                                        <th>Usuario:</th>
                                        <th>Email:</th>
                                        <th>Tipo de conta:</th>
                                        <th>Estado da conta:</th>
                                        <th>Espaço da conta:</th>
                                        <th>Data e hora de criação da conta:</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="user">
                                </tbody>
                            </table>
                        </form>
                    </div>
                </div>

            </div>

            <div class="row mt">
                <div class="col-md-6 mb">
                    <div class="form-panel">
                        <div class="col-md-12 mb" style="background: #3D3D3D;color:white;">
                            <center>
                                <h4>Adicionar nova conta ..</h4></center>
                        </div>

                        <span id="error3"></span>

                        <form class="form-horizontal style-form" id="myForm2">

                            <div class="form-group">
                                <label class="col-lg-2 col-sm-2 control-label">Usuario :</label>
                                <div class="col-lg-10">
                                    <p class="form-control-static">
                                        <input type="text" name="usuario1" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-2 col-sm-2 control-label">Nome :</label>
                                <div class="col-lg-10">
                                    <p class="form-control-static">
                                        <input type="text" name="nome1" class="form-control">
                                    </p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-2 col-sm-2 control-label">Email :</label>
                                <div class="col-lg-10">
                                    <p class="form-control-static">
                                        <input type="email" class="form-control" name="email1">
                                    </p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-2 col-sm-2 control-label">Password :</label>
                                <div class="col-lg-10">
                                    <p class="form-control-static">
                                        <input type="password" class="form-control" name="password1">
                                        </span>
                                </div>
                            </div>
                            <a class="btn btn-success" onclick="criar()">Salvar</a>
                        </form>
                    </div>
                </div>

                <div class="col-md-6 mb">
                    <div class="form-panel">
                        <div class="col-md-12 mb" style="background: #3D3D3D;color:white;">
                            <center>
                                <h4>Alterar os dados ..</h4></center>
                        </div>
                        <% if (message.length> 0) { %>
                         <center>  <div class="alert alert-dismissible alert-danger">
                                <%=message %>
                            </div></center> 
                            <% } %>

                                <form class="form-horizontal style-form" action="../user" method="post">

                                    <div class="form-group">
                                        <label class="col-lg-2 col-sm-2 control-label">Usuario :</label>
                                        <div class="col-lg-10">
                                            <p class="form-control-static">
                                                <span id="usuario_in">  <%=user.local.usuario %></p></span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-lg-2 col-sm-2 control-label">Nome :</label>
                                        <div class="col-lg-10">
                                            <p class="form-control-static">
                                                <span id="nome_in">  <%=user.local.nome %> </span>
                                            </p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-lg-2 col-sm-2 control-label">Email :</label>
                                        <div class="col-lg-10">
                                            <p class="form-control-static">
                                                <span id="email_in"> <%=user.local.email %>  </span>
                                            </p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-lg-2 col-sm-2 control-label">Password :</label>
                                        <div class="col-lg-10">
                                            <p class="form-control-static">
                                                <span id="password_in"></span><code> Por motivos de segurança n sera mostrada a password !!</code> </p>
                                            </span>
                                        </div>
                                    </div>

                                    <span id="alterar"> <a type="button" class="btn btn-warning" onclick="user()">Alterar</a> </span>
                                    <span id="salvar_in"></span>
                                    <span id="cancelar"></span>
                                </form>
                    </div>
                </div>
            </div>
        </section>
    </section>

    <% include ../upload/uploads-layouts/footer %>
        <% include ../upload/uploads-layouts/javascript %>>

            <link rel="stylesheet" href="//cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css">
            </style>
            <script type="text/javascript" src="//cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>

            <!--<script type="text/javascript" src="../assets/js/js.js"></script>-->
            
            <script type="text/javascript">
                
                
                 window.onload = function () { // Faz iniciar a tabela ao iniciar a pagina !!
                    usuario();
                    // tabela_usuario();
                };

                function user() {
                    var usuario = '<%=user.local.usuario %>';
                    var nome = '<%=user.local.nome %>';
                    var emaill = '<%=user.local.email %>';
                    document.getElementById("alterar").innerHTML = '';
                    document.getElementById("usuario_in").innerHTML = '<input type="text" name="usuario" class="form-control" value="'+usuario+'">';
                    document.getElementById("nome_in").innerHTML = '<input type="text" name="nome" class="form-control" value="'+nome+'">';
                    document.getElementById("email_in").innerHTML = '<input type="email" class="form-control" name="email" value="'+emaill+'">';
                    document.getElementById("salvar_in").innerHTML = '<button type="submit" class="btn btn-success">Salvar</button>';
                    document.getElementById("cancelar").innerHTML = '<button type="button" class="btn btn-danger"  onclick="cancelar()">cancelar</button>';
                }

                function cancelar() {
                    document.getElementById("usuario_in").innerHTML = '<%=user.local.usuario %>';
                    document.getElementById("nome_in").innerHTML = '<%=user.local.nome %>';
                    document.getElementById("email_in").innerHTML = '<%=user.local.email %>';
                    document.getElementById("salvar_in").innerHTML = '';
                    document.getElementById("cancelar").innerHTML = '';
                    document.getElementById("alterar").innerHTML = '<button type="button" class="btn btn-warning" onclick="user()">Alterar</button>';
                }

                function usuario() { // Tabela de todos os arquivos em upload
                    var tabela = '';
                    var b = "'";
                    $.getJSON("../db", function (result) {
                        $.each(result, function (i, field) {
                            tabela += '<tr>';
                            tabela += '<td>' + field._id + '</td>';
                            tabela += '<td>' + field.local.nome + '</td>';
                            tabela += '<td>' + field.local.usuario + '</td>';
                            tabela += '<td>' + field.local.email + '</td>';
                            tabela += '<td>' + field.local.su + '</td>';
                            tabela += '<td>' + field.local.estado + '</td>';
                            tabela += '<td>' + field.local.size + ' MB</td>';
                            tabela += '<td>' + field.local.date.toString().replace(/T/, ' ').replace(/\..+/, '') + '</td>';
                            tabela += '<td> <a onclick="vizualizar(' + b + field._id + b + ',' + b + field.local.nome + b + ',' + b + field.local.usuario + b + ',' + b + field.local.email + b + (',') + b + field.local.date + b + (',') + b + field.local.size + b + (',') + b + field.local.estado + b + (',') + b + field.local.su + b + ')" class="btn btn-default"  data-toggle="modal" data-target="#vizualizar">Vizualizar</a> </td>'
                            tabela += '</tr>';
                            $('#user').html(tabela);
                        });
                        tabela_usuario();
                    });
                }
                
                function tabela_usuario() {
                    $(document).ready(function () {
                        $('#minhaTabela').dataTable();
                    });
                }

                var named = '';
                var user_mod = '';
                var emaill = '';
                var idss = '';
                var data = '';
                var tamanho = '';
                var state = '';
                var type = '';

                function vizualizar(id, nome, usuario, email, date, size, estado, tipo) {
                    window.idss = id;
                    window.named = nome;
                    window.user_mod = usuario;
                    window.emaill = email;
                    window.data = date;
                    window.tamanho = size;
                    window.state = estado;
                    window.type = tipo;
                    document.getElementById("id_modal").innerHTML = id;
                    document.getElementById("us").innerHTML = usuario;
                    document.getElementById("nome").innerHTML = nome;
                    document.getElementById("email").innerHTML = email;
                    document.getElementById("estado_modal").innerHTML = estado;
                    document.getElementById("tipo_modal").innerHTML = tipo;
                    document.getElementById("tamanho_modal").innerHTML = size + ' MB';
                    document.getElementById("data_modal").innerHTML = date.toString().replace(/T/, ' ').replace(/\..+/, '');
                    document.getElementById("salvar_modal").innerHTML = '';
                    document.getElementById("cancelar_modal").innerHTML = '';
                    document.getElementById("alterar_modal").innerHTML = '<button type="button" class="btn btn-warning" onclick="vizualizar_modal()">Alterar</button>';
                    document.getElementById("remover_conta").innerHTML = '<a href="../remover/'+id+'" class="btn btn-danger pull-right">Apagar conta</a>';
                }
                
                

                function vizualizar_modal() {
                    document.getElementById("us").innerHTML = '<input type="text" name="usuario" id="usuario" class="form-control" value="' + window.user_mod + '">';
                    document.getElementById("nome").innerHTML = '<input type="text" name="nome" id="nome" class="form-control" value="' + window.named + '">';
                    document.getElementById("email").innerHTML = '<input type="text" class="form-control" name="email" id="email" value="' + window.emaill + '">';
                    document.getElementById("tipo_modal").innerHTML = '<select name="tipo" class="form-control" id="tipo"> <option value="' + window.type + '">Selecione um:</option> <option value="usuario">usuario (normal)</option> <option value="admin">admin</option> </select>';
                    document.getElementById("estado_modal").innerHTML = '<select name="estado" class="form-control" id="estado"> <option value="' + window.state + '">Selecione um:</option> <option value="activa">activa</option> <option value="suspensa">suspensa</option><option value="desactivada">desactivada</option> </select>';
                    document.getElementById("tamanho_modal").innerHTML = '<input  class="form-control" type="number" id="size" name="size" value="' + window.tamanho + '" step="100">';
                    document.getElementById("cancelar_modal").innerHTML = '<button type="button" class="btn btn-warning" onclick="back_modal()">Cancelar</button>';
                    document.getElementById("salvar_modal").innerHTML = '<a onclick="enviar()" class="btn btn-success">Salvar</a>';
                    document.getElementById("alterar_modal").innerHTML = '';
                    
                    
                }

                function back_modal() {
                    document.getElementById("us").innerHTML = window.user_mod;
                    document.getElementById("nome").innerHTML = window.named;
                    document.getElementById("email").innerHTML = window.emaill;
                    document.getElementById("tipo_modal").innerHTML = window.type;
                    document.getElementById("estado_modal").innerHTML = window.state;
                    document.getElementById("tamanho_modal").innerHTML = window.tamanho + ' MB';
                    document.getElementById("salvar_modal").innerHTML = '';
                    document.getElementById("cancelar_modal").innerHTML = '';
                    document.getElementById("alterar_modal").innerHTML = '<button type="button" class="btn btn-warning" onclick="vizualizar_modal()">Alterar</button>';
                }

                function enviar() {

                    $.post("../user/admin", {
                            id: window.idss,
                            nome: $("input[name$='nome']").val(),
                            usuario: $("input[name$='usuario']").val(),
                            email: $("input[name$='email']").val(),
                            size: $("input[name$='size']").val(),
                            tipo: $("select[name$='tipo'] option:selected").val(),
                            estado: $("select[name$='estado'] option:selected").val()
                        },
                        function (data, status) {
                            usuario();
                            atualizar_dados_modal_e_back();
                            var papersObject = JSON.stringify(data.result);

                            if (papersObject == undefined) {
                                document.getElementById("erro2").innerHTML = ''

                            }
                            else {
                                if (papersObject.length > 0) {
                                    document.getElementById("erro2").innerHTML = '<div class="alert alert-dismissible alert-danger"> ' + papersObject.split('"').join('') + ' </div>'
                                }
                            }

                        });
                }
                
                function vizualizar_pass() {
                    
                document.getElementById("alterar_passwor").innerHTML = '<button type="button" class="btn btn-warning" onclick="password_ad()">Salvar Password </button>'; 
                document.getElementById("password_addd").innerHTML = '<input type="password" class="form-control" name="password_alt">';
                    
                }
                
                function password_ad() {
                             
                    $.post("../user/admin/pass", {
                            id: window.idss,
                            password: $("input[name$='password_alt']").val(),
                        },
                        function (data, status) {
                            usuario();
                            atualizar_dados_modal_e_back();
                            var papersObject = JSON.stringify(data.result);

                            if (papersObject == undefined) {
                                document.getElementById("erro2").innerHTML = ''

                            }
                            else {
                                if (papersObject.length > 0) {
                                    document.getElementById("erro2").innerHTML = '<div class="alert alert-dismissible alert-danger"> ' + papersObject.split('"').join('') + ' </div>'
                                }
                            }

                        });
                }
                
                 function atualizar_dados_modal_e_back() {
                    $.getJSON('../db/' + window.idss, function (result) {
                        
                    window.named = result.local.nome;
                    window.user_mod = result.local.usuario;
                    window.emaill = result.local.email;
                    window.tamanho = result.local.size;
                    window.state = result.local.estado;
                    window.type = result.local.su;
                        
                        document.getElementById("painel_email").innerHTML = result.local.email;
                        document.getElementById("us").innerHTML = result.local.usuario;
                        document.getElementById("nome").innerHTML = result.local.nome;
                        document.getElementById("email").innerHTML = result.local.email;
                        document.getElementById("tipo_modal").innerHTML = result.local.su;
                        document.getElementById("estado_modal").innerHTML = result.local.estado;
                        document.getElementById("tamanho_modal").innerHTML = result.local.size + ' MB';
                        document.getElementById("salvar_modal").innerHTML = '';
                        document.getElementById("cancelar_modal").innerHTML = '';
                        document.getElementById("password_addd").innerHTML = '';
                        document.getElementById("alterar_modal").innerHTML = '<button type="button" class="btn btn-warning" onclick="vizualizar_modal()">Alterar</button>';
                        document.getElementById("alterar_passwor").innerHTML = '<button type="button" class="btn btn-warning" onclick="vizualizar_pass()">Alterar Password</button>';
                    });
                }
                
                
                 function criar() {

                    $.post("../signup_admin", {
                            nome: $("input[name$='nome1']").val(),
                            usuario: $("input[name$='usuario1']").val(),
                            email: $("input[name$='email1']").val(),
                            password: $("input[name$='password1']").val()
                        },
                        function (data, status) {
                            usuario();
                            var papersObject = JSON.stringify(data.result1);
                            if (papersObject == undefined) {
                                document.getElementById("error3").innerHTML = '';
                                document.getElementById("myForm2").reset();
                            }
                            else {
                                if (papersObject.length > 0) {
                                    document.getElementById("error3").innerHTML = '<div class="alert alert-dismissible alert-danger"> ' + papersObject.split('"').join('') + ' </div>';
                                }
                            }

                        });
                }
                
                  var doughnutData = [{
                                    value: <%=cpu%>,
                                    color: "#FFD777"
                                }, {
                                    value: 100 - <%=cpu%>,
                                    color: "#444c57"
                                }];
                                var myDoughnut = new Chart(document.getElementById("serverstatus01").getContext("2d")).Doughnut(doughnutData);
                                var doughnutData = [{
                                    value: <%=perc%>,
                                    color: "#FFD777"
                                }, {
                                    value: 100 - <%=perc%>,
                                    color: "#444c57"
                                }];
                                var myDoughnut = new Chart(document.getElementById("serverstatus02").getContext("2d")).Doughnut(doughnutData);
                                var doughnutData = [{
                                    value: <%=total_2%>,
                                    color: "#FFD777"
                                }, {
                                    value: 100 - <%=total_2%>,
                                    color: "#444c57"
                                }];
                                var myDoughnut = new Chart(document.getElementById("serverstatus04").getContext("2d")).Doughnut(doughnutData);
                
            </script>

            </body>

            </html>